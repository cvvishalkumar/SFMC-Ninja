  <html lang="en">
  <head>
    <meta charset="UTF-8">
    <meta name="robots" content="index, follow" />
    <link rel="icon" type="image/png" href="SFMC_Ninja_fav.png"/> 
    <meta name="googlebot" content="index, follow, max-snippet:-1, max-image-preview:large, max-video-preview:-1" />
    <meta name="bingbot" content="index, follow, max-snippet:-1, max-image-preview:large, max-video-preview:-1" />
    <link rel="canonical" href="https://cvvishalkumar.github.io/sfmc-ninja/" />
    <meta property="og:locale" content="en_US" />
    <meta property="og:type" content="article" />
    <meta property="og:title" content="SFMC Ninja - develop SFMC platform like a Ninja" />
    <meta property="og:description" content="Use this tricks and tips on AMPscript, SSJS, SFMC API, WSproxy, SQL code snippets and SFMC platform secrets." />
    <meta property="og:url" content="https://cvvishalkumar.github.io/sfmc-ninja/" />
    <meta property="og:site_name" content="SFMC Ninja" />
    <title>SFMC Ninja</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link href="https://fonts.googleapis.com/css?family=Oswald:500|Roboto" rel="stylesheet">
    <link rel="stylesheet" type="text/css" href="SFMC_Ninja_Sytle01.css">
    <link rel="icon" href="SFMC_Ninja_fav.ico" type="image/png" sizes="16x16">
    <!-- LInkedin -->
    <script src="https://platform.linkedin.com/in.js" type="text/javascript"> lang: en_US</script>
    <script type="IN/FollowCompany" data-id="75598875" data-counter="bottom"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.24.1/themes/prism-dark.min.css" rel="stylesheet" />
    <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.24.1/prism.min.js"></script>
  <!-- Global site tag (gtag.js) - Google Analytics -->
<script async src="https://www.googletagmanager.com/gtag/js?id=G-NXQTE5YJPC"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());
  gtag('config', 'G-NXQTE5YJPC');
</script>
<!-- Google Tag Manager -->
<script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
  new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
  j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src=
  'https://www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);
  })(window,document,'script','dataLayer','GTM-NDKJVZH');</script>
  <!-- End Google Tag Manager --> 
  </head>
    <body>
     <!-- Google Tag Manager (noscript) -->
<noscript><iframe src="https://www.googletagmanager.com/ns.html?id=GTM-NDKJVZH"
  height="0" width="0" style="display:none;visibility:hidden"></iframe></noscript>
  <!-- End Google Tag Manager (noscript) -->
      <nav id="navbar">
        <div id="header-bg">
          <header style="color: #f9b520;">
            <div class="typing-slider">
              <p>Develop & Code Like a NINJA!</p>
            </div>
          </header>


        </div>
        <ul>
          <a class="nav-link" href="#resources">
            <li>Useful resources</li>
          </a>
          <a class="nav-link" href="#ampscript">
            <li>AMPscript snippets</li>
          </a>
          <a class="nav-link" href="#ssjs">
            <li>SSJS snippets</li>
          </a>
          <a class="nav-link" href="#apis">
            <li>SFMC API snippets</li>
          </a>
          <a class="nav-link" href="#wsproxy">
            <li>WSProxy snippets</li>
          </a>
          <a class="nav-link" href="#SQL">
            <li>SQL snippets</li>
          </a>
        </ul>
        <div id="Handcrafted">
               <h3 class="typing">Handcrafted with &hearts; by <a href="https://www.linkedin.com/in/cvvishalkumar/" target="_blank">Vishal Kumar C V</a></h3>
        </div>
      </nav>

      <main id="main-doc">
        <section>
          <div class="logo"><img src="SFMC_Ninja_LOGO.png"></div>
        </section>

        <section>
          <div id="slider">
            <ul>
              <li>
              <div class="slider-container">
                <h4>Pure CSS slider Content</h4>
                <p>Lorem Ipsum is simply dummy text of the printing and typesetting industry. Lorem Ipsum has been the industry's standard dummy text ever since the 1500s, when an unknown printer took a galley of type and scrambled it to make a type specimen book. It has survived not only five centuries,</p>
              </div>
              </li>
                <li>
                <div class="slider-container">
                   <h4>Pure CSS slider Content</h4>
                <p>Lorem Ipsum is simply dummy text of the printing and typesetting industry. Lorem Ipsum has been the industry's standard dummy text ever since the 1500s, when an unknown printer took a galley of type and scrambled it to make a type specimen book. It has survived not only five centuries,</p>
              </div>
              </li>
                <li>
                <div class="slider-container">
                   <h4>Pure CSS slider Content</h4>
                <p>Lorem Ipsum is simply dummy text of the printing and typesetting industry. Lorem Ipsum has been the industry's standard dummy text ever since the 1500s, when an unknown printer took a galley of type and scrambled it to make a type specimen book. It has survived not only five centuries,</p>
              </div>
              </li>
                <li>
                <div class="slider-container">
                  <h4>Pure CSS slider Content</h4>
                <p>Lorem Ipsum is simply dummy text of the printing and typesetting industry. Lorem Ipsum has been the industry's standard dummy text ever since the 1500s, when an unknown printer took a galley of type and scrambled it to make a type specimen book. It has survived not only five centuries,</p>
              </div>
              </li>
            </ul>
            </div>
        </section>
        <section id="resources" class="main-section">
          <h1>Become a SFMC pro-developer using these useful resources</h1>
          <article>
            <h4>Begin your SFMC journey by learning basics from here,</h4>
            <ul class="heart">
              <li><span style="color: #b97f02;">SFMC VIDEO tutorials</span> <p>Click here to access the <a href="https://tidbitsforu.com/sfmc-video-resources/">Salesforce Marketing Cloud â€“ Video Resources</a> by the SFMC Champion <a href="https://linkedin.com/in/shibua" target="_blank">Shibu Abraham</a> </p>
              </li>
              
             <li><span style="color: #b97f02;">AMPscript</span> <p>Learn about AMPscript from here on <a href="https://ampscript.guide">ampscript.guide</a> built by the Salesforce MVPs <a href="https://mc.chat/" target="_blank">Eliot Harper</a> and  <a href="https://sprignaturemoves.com/about-me/" target="_blank">Adam Spriggs</a> </p>
             </li>
             <li><span style="color: #b97f02;">SSJS</span> <p>Learn about SSJS from here on <a href="https://gortonington.com/sfmc-server-side-javascript-1-intro/">gortonington.com</a> built by the Salesforce MVP <a href="https://gortonington.com/home/about-me/" target="_blank">Gregory Gifford</a>. </p>
             </li>
             <li><span style="color: #b97f02;">Data Views</span> <p>Learn about and use this awesome visualization of Data Views here on <a href="https://sfmarketing.cloud/2021/02/01/updated-data-views-visualization/">sfmarketing.cloud</a> by the Salesforce MVP <a href="https://sfmarketing.cloud/about/" target="_blank">Zuzanna Jarczynska</a>. </p>
             </li>
             <li><span style="color: #b97f02;">SFMC APIs</span> <p>Learn about SFMC REST and SOAP API from here on <a href="https://www.postman.com/salesforce-developers/workspace/salesforce-developers/folder/14448118-4571ab6a-0940-40e7-be5f-47edce80c88d?ctx=documentation">Salesforce Developers</a>. </p>
             </li>
             <li><span style="color: #b97f02;">Convert your Cloug page into a Coding playground</span><p>You may feel Practicing AMPscript / SSJS / WSproxy some times feel tedious task. Especially for the fact of re-publishing the Cloud pages everytime you make an edit!. Hence refer this awesome trick which might save you tons of minute. <a href="https://www.marketingdeveloper.io/garden/develop-sfmc-cloudpages-using-github-private-repositories">Develop Cloudpages using Github private repository</a> by <a href="https://www.linkedin.com/in/susane-antunes">Susane Antunes</a>. </p>
             </li>
           </ul>

           <h1><br><br></h1>

         </article>
       </section>
       <b class="hr anim"></b>
       <section id="ampscript" class="main-section">
        <header>AMPscript</header>

<!--AMP Block1 -->
<p>Don't be surprized! This is tag based syntax of AMPscript!!</p>
<pre><code class="language-js" >&lt;script runat=&#39;server&#39; language=&#39;ampscript&#39;&gt;
  Output(Concat(&#39;Welcome &#39;,&#39;to SFMC-NINJA&#39;))
&lt;/script&gt;</code></pre>
<br>
<!-- AMP Block2 -->
<br>
<p>Email Salutation  - snippet</p>
<pre><code class="language-js" >%%[
  set @FirstName = AttributeValue(&#x22;FirstName&#x22;)
  set @Salutation = iif(length(@FirstName) &#x3E; 1, ProperCase(@FirstName), &#x22;Customer&#x22;)
]%%
  
Dear %%=v(@Salutation)=%%,</code></pre>
<br>

<!-- AMP Block3 -->
<br>
<p>Excluding code execution - SendPreview and test send</p>
<pre><code class="language-js" >IF (_messagecontext != &#x22;PREVIEW&#x22; AND _isTestSend != true) THEN
  CreateSalesforceObject(.....
ENDIF</code></pre>
<br>

<!-- AMP Block4 -->
<br>
<p>Hiding the View As Web Page - when viewed on browser</p>
<pre><code class="language-js" >%%[IF _messagecontext != &#x27;VAWP&#x27; THEN]%%
  &#x3C;table border=&#x22;0&#x22; cellspacing=&#x22;0&#x22; cellpadding=&#x22;0&#x22; align=&#x22;center&#x22; width=&#x22;100%&#x22; style=&#x22;background-color:#ffffff;&#x22; bgcolor=&#x22;#ffffff&#x22;&#x3E;
           &#x3C;tr&#x3E;
            &#x3C;td valign=&#x22;middle&#x22; align=&#x22;center&#x22; style=&#x22;font-family: Arial, sans-serif;  font-size:12px; color:#000001&#x22;&#x3E;
             To view this email as a web page, click &#x3C;a href=&#x22;%%view_email_url%%&#x22; target=&#x22;_blank&#x22; style=&#x22;text-decoration:underline; color:blue;&#x22;&#x3E;here&#x3C;/a&#x3E;.&#x3C;/td&#x3E;
           &#x3C;/tr&#x3E;
          &#x3C;/table&#x3E;
%%[ENDIF]%%</code></pre>
<br>

<!-- AMP Block5 -->
<br>
<p>Retrieve ALL records of a Data Extension and make perform Upsert/any action</p>
<pre><code class="language-js">//AMPscript - Snippet - LOOP though DataExtension rows and get specific field in each row
%%[
  SET @DE_rows = Lookuprows(&quot;Name_of_your_DE&quot;,&quot;default&quot;,&quot;1&quot;) //Make sure to create a field called &#39;default&#39; with default value = &#39;1&#39;
  SET @DE_rowsCount = Rowcount(@DE_rows)

  For @i = 1 to @DE_rowsCount do
      SET @DE_row = Row(@DE_rows,@i)
      SET @DE_field_name = Field(@DE_row,&#39;SubscriberKey&#39;) //In my case I am fetching the field called &#39;SubscriberKey&#39;
      //Output(Concat(@DE_field_name,&quot;&lt;br/&gt;&quot;))  --&gt; Uncomment this to check whether your loop fetching the required field
      // UpdateSingleSalesforceObject(&#39;Contact&#39;,@DE_field_name,&#39;Vis_custom_field_for_journey__c&#39;,&#39;FALSE&#39;) --&gt; PLACE your code to perform your required action.
  NEXT @i
]%%</code></pre>
<br>

<!-- AMP Block6 -->
<br>
<p>Passing encrypted parameters to Cloudpages | From Email]</p>
<pre><code class="language-js">//Parameters will be encrypted in URL [Example: xxxx.com?qs=2f6e3f80d6017db21xxxxxxxxxxx]
&lt;a href=&quot;%%=RedirectTo(CloudPagesURL(xxx,&#39;subkey&#39;,_subscriberkey))=%%&quot;&gt;Go to cloud page&lt;/a&gt;
// On cloud page : below works only for GET methodset 
@subkey = RequestParameter(&quot;subkey&quot;)


//Parameters will be visible in the URL [?name=VishalKumarCV]
&lt;a href=&quot;%%=Concat(RedirectTo(CloudpagesURL(xxx)),&#39;&amp;name=&#39;,@varname)=%%&quot;&gt;Go to cloud page&lt;/a&gt;
// On cloud page : below works only for GET method
set @name = QueryParameter(&quot;name&quot;)


//Works only if coming from CloudPagesURL method.
set @SubscriberKey = AttributeValue(&#39;_SubscriberKey&#39;)</code></pre>
<br>

<!-- AMP Block7 -->
<br>
<p>Generic Parameters for Google Analytics Integration</p>
<pre><code class="language-js">utm_source=SFMC&utm_medium=EMAIL&utm_campaign=%%emailname_%%&utm_term=%%linkname%%&utm_id=%%jobid%%&sfmc_id=%%subscriberid%%</code></pre>
<br>

<!-- AMP Block8 -->
<br>
<p>AMPscript String reverse</p>
<pre><code class="language-js">%%[
  var @name, @rev_name
  SET @name = 'vishal'
  
  FOR @i = Length(@name) DOWNTO 1 DO
      SET @rev_name = Concat(@rev_name,Substring(@name,@i,1))
  NEXT @i
  
  Output(Concat('Given name = ',@name)) //vishal
  Output(Concat('<br>Reversed = ',@rev_name)) //lahsiv
  ]%%</code></pre>
<br>

<!-- ************************************************* -->
<!-- ************************************************* -->

</section>
      <b class="hr anim"></b>
      <section id="ssjs" class="main-section">
        <header>SSJS - Server Side Java Script</header>

<!-- SSJS block1 -->
<p>Basic syntax of SSJS [with try/catch]</p>
<pre><code class="language-js" >&lt;script runat=&quot;server&quot;&gt;
Platform.Load(&quot;Core&quot;,&quot;1.1&quot;);
try{
&lt;/script&gt;

%%[ Place your AMPscript code here ]%%

&lt;script runat=&quot;server&quot;&gt;
} catch(Error) { Write(Stringify(Error)); }
&lt;/script&gt;</code></pre>
<br>

<br>
<p>Contacts deletion using SSJS/Automation</p>
<pre><code class="language-js"><script language="javascript" runat="server"> 
  Platform.Load("core","1.1.5");
  
  try{
  /* var eid = Platform.Function.AuthenticatedEnterpriseID(); use this if running from parent BU else hardcode as below*/
  var eid = '51000xxxx';
  var deKey = '_Your_DEkey_from_which_Contacts_to_be_Deleted';
  var clientId = 'xxxxxxxxxxxxxxxxxxxxxx';
  var clientSecret = 'xxxxxxxxxxxxxxxxxx';
  var authBaseUrl = 'https://xxxxxxxxxxxxxxxxx.auth.marketingcloudapis.com/';
  
  var authUrl = authBaseUrl + 'v2/token/'
  var contentType = 'application/json';
  
  payload =  '{';
  payload += ' "grant_type": "client_credentials",';
  payload += ' "client_id":"' + clientId + '",';
  payload += ' "client_secret":"' + clientSecret + '",';
  payload += ' "scope": "list_and_subscribers_write",';
  payload += ' "account_id": "' + eid + '" ';
  payload += '}';
  
  var result = HTTP.Post(authUrl, contentType, payload);
  var response = result["Response"][0];
  var accessToken = Platform.Function.ParseJSON(response).access_token;
  var restUrl = Platform.Function.ParseJSON(response).rest_instance_url;
  
  Platform.Response.Write(" response: " + response);
  Platform.Response.Write("\n\n token: " + accessToken);
  Platform.Response.Write("\n\n rest URL: " + restUrl);
  
  var headerNames = ["Authorization"];
  var headerValues = ["Bearer " + accessToken];
  
  payload =  '{';
  payload += '   "deleteOperationType": "ContactAndAttributes",';
  payload += '   "targetList": { ';
  payload += '      "listType": { ';
  payload += '         "listTypeID":3';
  payload += '      },';
  payload += '   "listKey": "' + deKey + '"';
  payload += '   },';
  payload += '   "deleteListWhenCompleted":false,';
  payload += '   "deleteListContentsWhenCompleted":true';
  payload += '}';
  
  var deleteEndpoint = restUrl + 'contacts/v1/contacts/actions/delete?type=listReference';
  var result = HTTP.Post(deleteEndpoint, contentType, payload, headerNames, headerValues)
  result = Stringify(result).replace(/[\n\r]/g, '');
  Platform.Response.Write("\n\n result: " + result);
  }
  catch(e) {  Write(Stringify(e)); }
  </script></code></pre>
<br>

<br>
<p>Run child automations from a Parent automation [using Script Activity]</p>
<pre><code class="language-js" ><script runat="server">
  Platform.Load("Core","1.1.1");
  
  var automationCustomerKey = "_Customer-key_of_the_automation_to_run_";
  
  var rr = Platform.Function.CreateObject("RetrieveRequest");
  Platform.Function.SetObjectProperty(rr, "ObjectType", "Automation");
  Platform.Function.AddObjectArrayItem(rr, "Properties", "ProgramID");
  Platform.Function.AddObjectArrayItem(rr, "Properties", "CustomerKey");
  Platform.Function.AddObjectArrayItem(rr, "Properties", "Status");
  
  var sfp = Platform.Function.CreateObject("SimpleFilterPart");
  Platform.Function.SetObjectProperty(sfp, "Property", "CustomerKey");
  Platform.Function.SetObjectProperty(sfp, "SimpleOperator", "equals");
  Platform.Function.AddObjectArrayItem(sfp, "Value", automationCustomerKey);
  
  Platform.Function.SetObjectProperty(rr, "Filter", sfp);
  var retrieveStatus = [0,0,0];
  var automationResultSet = Platform.Function.InvokeRetrieve(rr, retrieveStatus);
  var ObjectID = automationResultSet[0]["ObjectID"];
  var Status = automationResultSet[0]["Status"];
  
  if (ObjectID != "null") 
  {
      /* Code Status
      -1 = Error, 0 = BuildingError, 1 = Building, 2 = Ready, 3 = Running, 4 = Paused,
       5 = Stopped, 6 = Scheduled, 7 = Awaiting Trigger, 8 = InactiveTrigger
      */
  
      if (Status == 2) 
      {
          var obj = Platform.Function.CreateObject("Automation");
          Platform.Function.SetObjectProperty(obj, "ObjectID", ObjectID);
          var po = Platform.Function.CreateObject("PerformOptions");
          var performResult = [0,0,0];
          var performStatus = Platform.Function.InvokePerform(obj, "start", performResult, po);
      }
  
      else
      {
          // already running
      }
  
  } 
  else 
  {
     // automation not found
  }
  </script></code></pre>
<br>

      </section>
      <b class="hr anim"></b>
<section id="apis" class="main-section">
  <header>SFMC | REST - SOAP APIs</header>
  <p>Please refer the below link to get all the latest API endpoints with usage details,<br> <a href="https://www.postman.com/salesforce-developers/workspace/salesforce-developers/request/14448118-2c11c812-8375-459a-978c-2338dd5f0c0e">Salesforce Developers</a> </p>
  <br>

  <br>
  <!-- SOAP block1 -->
  <p>API to create TSD [Triggered Send Definition]</p>
  <pre><code class="language-js">POST HTTP/1.1
Host: https://{{et_subdomain}}.soap.marketingcloudapis.com/Service.asmx
Content-Type: text/xml

    &#x3C;?xml version=&#x22;1.0&#x22; encoding=&#x22;UTF-8&#x22;?&#x3E;
    &#x3C;s:Envelope xmlns:s=&#x22;http://www.w3.org/2003/05/soap-envelope&#x22; xmlns:a=&#x22;http://schemas.xmlsoap.org/ws/2004/08/addressing&#x22; xmlns:u=&#x22;http://docs.oasis-open.org/wss/2004/01/oasis-200401-wss-wssecurity-utility-1.0.xsd&#x22;&#x3E;
       &#x3C;s:Header&#x3E;
            &#x3C;a:Action s:mustUnderstand=&#x22;1&#x22;&#x3E;Create&#x3C;/a:Action&#x3E;
            &#x3C;a:MessageID&#x3E;urn:uuid:7e0cca04-57bd-4481-864c-6ea8039d2ea0&#x3C;/a:MessageID&#x3E;
            &#x3C;a:ReplyTo&#x3E;
                &#x3C;a:Address&#x3E;http://schemas.xmlsoap.org/ws/2004/08/addressing/role/anonymous&#x3C;/a:Address&#x3E;
            &#x3C;/a:ReplyTo&#x3E;    
            &#x3C;a:To s:mustUnderstand=&#x22;1&#x22;&#x3E;{{soapEndPoint}}&#x3C;/a:To&#x3E;
            &#x3C;fueloauth xmlns=&#x22;http://exacttarget.com&#x22;&#x3E;{{accessToken}}&#x3C;/fueloauth&#x3E;
       &#x3C;/s:Header&#x3E;
       &#x3C;s:Body xmlns:xsd=&#x22;http://www.w3.org/2001/XMLSchema&#x22; xmlns:xsi=&#x22;http://www.w3.org/2001/XMLSchema-instance&#x22;&#x3E;
        &#x3C;CreateRequest xmlns=&#x22;http://exacttarget.com/wsdl/partnerAPI&#x22;&#x3E;
            &#x3C;Options/&#x3E;
                &#x3C;Objects xsi:type=&#x22;TriggeredSendDefinition&#x22;&#x3E;
                    &#x3C;PartnerKey xsi:nil=&#x22;true&#x22;/&#x3E;
                    &#x3C;ObjectID xsi:nil=&#x22;true&#x22;/&#x3E;
                    &#x3C;CustomerKey&#x3E;xxxx&#x3C;/CustomerKey&#x3E; //External-ID of your NEW TSD
                    &#x3C;Name&#x3E;xxx&#x3C;/Name&#x3E; //Name of your NEW TSD
                    &#x3C;SendClassification&#x3E;
                        &#x3C;PartnerKey xsi:nil=&#x22;true&#x22;/&#x3E;
                        &#x3C;CustomerKey&#x3E;12345&#x3C;/CustomerKey&#x3E; //External-ID of your Send classification
                        &#x3C;ObjectID xsi:nil=&#x22;true&#x22;/&#x3E;
                    &#x3C;/SendClassification&#x3E;
                    &#x3C;Email&#x3E;
                        &#x3C;PartnerKey xsi:nil=&#x22;true&#x22;/&#x3E;
                        &#x3C;ObjectID xsi:nil=&#x22;true&#x22;/&#x3E;
                        &#x3C;ID&#x3E;123456&#x3C;/ID&#x3E; //Email-ID of your email in Content builder
                    &#x3C;/Email&#x3E;
                    &#x3C;SendSourceDataExtension&#x3E;
                        &#x3C;CustomerKey&#x3E;xxxx-xxxx-xxxx-xxxx-xxxx&#x3C;/CustomerKey&#x3E; //External-ID of your TriggeredSendDataExtension
                    &#x3C;/SendSourceDataExtension&#x3E;
                &#x3C;/Objects&#x3E;
        &#x3C;/CreateRequest&#x3E;
       &#x3C;/s:Body&#x3E;
    &#x3C;/s:Envelope&#x3E;</code></pre>
  <br> 
</section>

<b class="hr anim"></b>
<section id="wsproxy" class="main-section">
  <header>WSproxy - WebSocket Proxy</header>

<br>

<br>
<!-- WSproxy block1 -->
<p><span class="use-case">Use case: </span>Adding subscriber to List/Publication list</p>
<span style="color:#f9b520;">Email code</span>
<pre><code class="language-js">%%[
  SET @sub = [_subscriberkey]
  SET @email = [emailaddr]
]%%
  
Click here to &#x3C;a href=&#x22;%%=RedirectTo(CloudPagesURL(7777,&#x22;sub&#x22;,@sub,&#x22;email&#x22;,@email))=%%&#x22;&#x3E;Subscribe&#x3C;/a&#x3E;</code></pre>
<span style="color:#f9b520;">Cloud Page code</span>
<pre><code class="language-js">%%[
  SET @sub = RequestParameter(&#x27;sub&#x27;) 
  SET @email = RequestParameter(&#x27;email&#x27;)
  SET @Listid = &#x22;xxxxx&#x22;
  SET @listemailexist = Lookup(&#x22;_ListSubscribers&#x22;,&#x22;EmailAddress&#x22;,&#x22;ListID&#x22;, @Listid,&#x22;EmailAddress&#x22;, @email)
]%%
  
%%[if @listemailexist == @email Then]%%
    &#x3C;p&#x3E;You are already subscribed!&#x3C;/p&#x3E;
%%[ELSE]%%
  &#x3C;script runat=&#x22;server&#x22;&#x3E;
  Platform.Load(&#x22;core&#x22;,&#x22;1.1.5&#x22;); 
  var prox = new Script.Util.WSProxy();
  var options = {SaveOptions: [{&#x27;PropertyName&#x27;: &#x27;*&#x27;, SaveAction: &#x27;UpdateAdd&#x27;}]};
  
  //getting values from AMPSCRIPT variables to SSJS variables
  var email = Variable.GetValue(&#x22;@email&#x22;);
  var subscriberkey = Variable.GetValue(&#x22;@sub&#x22;);
  
  function AddToSub(obj) {
  var props = { 
  SubscriberKey: subscriberkey,
  EmailAddress: email,
  Lists: [{
  ID: obj.listID,
  Status: &#x27;Active&#x27; // to unsub = &#x22;Unsubscribed&#x22; to subscribe = &#x22;Active&#x22;
  }]
  };
  var data = prox.updateItem(&#x22;Subscriber&#x22;, props, options);
  return data.Results[0].StatusCode;
  }
  
  var myPubLists = [
  {mid:&#x27;1000xxxxxx&#x27;, listID:&#x27;xxxxx&#x27;}
  ];
  
  for (var i=0; i&#x3C;myPubLists.length; i++) {
  var result = AddToSub(myPubLists[i]);
  Write(&#x22;You have been successfully subscribed!&#x22;);
  }
  &#x3C;/script&#x3E;
%%[ENDIF]%%</code></pre>
<br>

</section>

<section id="SQL" class="main-section">
    <h1>Some useful SQL snippets based on reallife implementations</h1>
    <article>
      <br>
      <!-- SQL block1 -->
      <p><span class="use-case">Use case: </span>Get BOUNCE/OPEN/SENT of previous day for a given TSD</p>
      <pre><code class="language-js" >SELECT Count(su.SubscriberKey) as &#x27;Sent_count&#x27;,
CONVERT(date, DATEADD(dd, -1, getdate())) as &#x27;Sent_On&#x27;,
&#x27;Your_TSD_External_Key&#x27; as &#x27;TSD_name&#x27;
FROM [_Sent] s
JOIN [_Subscribers] su
ON s.SubscriberID = su.SubscriberID
WHERE DateDiff(day,s.EventDate,GetDate()) = 1
AND s.TriggeredSendCustomerKey = &#x27;Your_TSD_External_Key&#x27;
</code></pre>
<pre><code class="language-js">
SELECT Count(su.SubscriberKey) as &#x27;Open_count&#x27;,
&#x27;Your_TSD_externalKey&#x27; as &#x27;TSD_name&#x27;
FROM [_Open] o
JOIN [_Subscribers] su
ON o.SubscriberID = su.SubscriberID
WHERE DateDiff(day,o.eventdate,GetDate()) = 1
AND o.IsUnique = &#x27;true&#x27;
AND o.TriggeredSendCustomerKey = &#x27;Your_TSD_externalKey&#x27;
</code></pre>
<pre><code class="language-js">
SELECT Count(su.SubscriberKey) as &#x27;Bounce_count&#x27;,
&#x27;Your_TSD_ExternalKey&#x27; as &#x27;TSD_name&#x27;
FROM [_Bounce] b
JOIN [_Subscribers] su
ON b.SubscriberID = su.SubscriberID
WHERE b.EventDate &#x3E; dateadd(hh,-24,getdate())
AND b.TriggeredSendCustomerKey = &#x27;Your_TSD_ExternalKey&#x27;
</code></pre>
      <br>

      <br>
      <!-- SQL block2 -->
      <p><span class="use-case">Use case: </span>SQL to Export List subscribers to Data Extension along with Profile attributes</p>
    <pre><code class="language-js">SELECT L.EmailAddress as &#x27;Email Address&#x27;, E.[First Name], 
E.[Last Name], E.Company, E.Phone, E.Country
FROM _ListSubscribers L
INNER JOIN ENT._EnterpriseAttribute E //Note this works on only Enterprise 2.0 accounts
ON E._SubscriberID = L.SubscriberID
WHERE L.ListID = &#x27;xxx&#x27; //this is your LIST ID</code></pre>


    </article>
</section>
</main>
</body>

</html>
